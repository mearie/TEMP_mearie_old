## vim: set syn=mako: <%inherit dummy/>
<%!
import subprocess

def gethgrev(path, tmpl):
	cmd = ['hg', 'log', '-ql1', '--template', tmpl, '--', path]
	return subprocess.Popen(cmd, stdout=subprocess.PIPE).communicate()[0]

# default values
title = None
%>

<%namespace name="m" file="/res/library.tmpl.html" import="*" />

<%def name="region(lang)">
${lang(ko=u'메아리', en=u'mearie.org')}
</%def>

<%def name="head(lang, title)">
<meta http-equiv="Content-Language" content="${lang|h}" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
% if title:
<title>${title|h} | ${self.region(lang)}</title>
% else:
<title>${self.region(lang)}</title>
% endif
<link rel="stylesheet" media="screen" href="/res/global.css" type="text/css" />
<!--[if IE]><link rel="stylesheet" media="screen" href="/res/global.ie.css" type="text/css" /><![endif]-->
</%def>

<%def name="sidebar(lang)">
<div class="slogan">
	<a href="/"><img class="logo" src="/res/logo.png" width="117" height="117" alt="${lang(ko=u'메아리 처음으로', en=u'Go to mearie.org front page.')}" /></a>
</div>
<div class="menu">
${self.menu(lang)}
</div>
<%doc>
<ul class="nav"><li lang="ko" class="current"><a href="index.ko">한국어</a></li><li lang="en"><a href="index.en">English</a></li><li lang="ja"><a href="index.ja">日本語</a></li></ul>
</%doc>
</%def>

<%def name="menu(lang)" filter="markdown">
* [${lang(ko=u'대하여', en=u'About')}](/about/)
* [${lang(ko=u'소프트웨어', en=u'Software Projects')}](/projects/)
* [${lang(ko=u'문서', en=u'Documents')}](/documents/)
* [${lang(ko=u'저널', en=u'Journal')}](http://j.mearie.org/)
* [${lang(ko=u'잡것', en=u'Stuffs')}](/stuffs/)
</%def>

<%def name="bodypre(lang, title)">
% if title:
<h1>${title|h}</h1>
% else:
<h1>${capture(self.region, lang)|h}</h1>
% endif
</%def>

<%def name="bodypost(lang)">
</%def>

<%def name="meta(lang)">
<div class="info">
	${gethgrev(self.uri, 'rev {node|short}') or 'working copy'}
</div>
<form action="http://www.google.com/cse" class="search">
	<input type="hidden" name="cx" value="017879559261112115196:ygyuirvfnku"/>
	<input type="text" name="q" size="30"/>
	<input type="submit" name="sa" value="${lang(ko=u'구글 검색', en=u'Google Search')}" class="button"/>
</form>
<div class="copyright">${lang(
	ko=u'저작권자 © 1999–2010 강 성훈. <a href="/about/copyright">저작권을 약간 가집니다.</a>',
	en=u'Copyright © 1999–2010 Kang Seonghoon. <a href="/about/copyright">Some Rights Reserved.</a>',
)|n}</div>
</%def>

<%
try:
    lang = Language(self.attr.language)
except AttributeError:
    for l in LANGUAGES:
        if ('.%s.' % l) in self.uri: lang = Language(l)

try:
    filter = self.attr.filter
except AttributeError:
    filter = markdown

try:
    title = self.attr.title
except AttributeError:
    title = u''
%>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="${lang|h}">
<head>
${self.head(lang, title=title)}
</head>
<body>
<div id="sitebody" lang="${lang|h}">
${self.bodypre(lang, title=title)}
${capture(self.body)|filter}
${self.bodypost(lang)}
</div>
<hr/>
<div id="siteside">
${self.sidebar(lang)}
</div>
<div id="sitemeta">
${self.meta(lang)}
</div>
</body>
</html>
