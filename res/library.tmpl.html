## vim: set syn=mako: <%inherit dummy/>
<%!
from mearie.image import imagesize

def uri_to_path(c, uri):
    return c.lookup.convert_to_path(c.lookup.adjust_uri(uri, c['topmost'].uri)) 

%>

<%def name="indent()">\
${capture(caller.body)|indent}
</%def>

<%def name="img(src, align='')">
<%
_, width, height = imagesize(uri_to_path(context, src))
%>
<img src="${src|h}" width="${width}" height="${height}" alt="${capture(caller.body)|h}" class="${align|h}" />\
</%def>

<%def name="imgframe(src, align='')">
<%
_, width, height = imagesize(uri_to_path(context, src))
%>
<div class="image-frame bordered ${align|h}" style="width:${width}px">\
<img src="${src|h}" width="${width}" height="${height}" alt="" class="bordered ${align|h}" />\
<div class="caption">${caller.body()}</div>\
</div>\
</%def>

<%def name="math(size='')">
% if size:
<span class="math math-size${int(size)}">\
% else:
<span class="math">\
% endif
${''.join('&#%d;' % ord(i) for i in capture(caller.body))}</span>\
</%def>

